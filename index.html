<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tilt Tap Demo</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 50px; }
    .angle { font-size: 1.8em; margin: 10px 0; }
    .status { font-size: 2.5em; margin-top: 30px; color: black; }
    button { padding: 10px 20px; font-size: 1em; margin-bottom: 20px; }
  </style>
</head>
<body>
  <h1>Tilt Tap Detection ðŸ“±</h1>
  <button id="start">Allow Motion Access</button>
  <div class="angle">Front/Back (Î²): <span id="beta">0</span>Â°</div>
  <div class="angle">Left/Right (Î³): <span id="gamma">0</span>Â°</div>
  <div class="status" id="status">Waiting...</div>

  <script>
    const betaEl = document.getElementById("beta");
    const gammaEl = document.getElementById("gamma");
    const statusEl = document.getElementById("status");
    const btn = document.getElementById("start");

    let baseTilt = null;
    let tapTimeout = null;
    const TILT_THRESHOLD = 12; // degrees to count as tilt
    const RETURN_THRESHOLD = 6; // degrees to count as returned

    btn.addEventListener("click", () => {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
        .then(permissionState => {
          if(permissionState === 'granted') {
            window.addEventListener('deviceorientation', detectTap);
          } else {
            alert("Permission denied ðŸ˜¢");
          }
        }).catch(console.error);
      } else {
        window.addEventListener('deviceorientation', detectTap);
      }
    });

    function detectTap(event) {
      const beta = event.beta;
      const gamma = event.gamma;

      betaEl.textContent = beta.toFixed(1);
      gammaEl.textContent = gamma.toFixed(1);

      if (!baseTilt) {
        // set initial tilt as reference
        baseTilt = { beta, gamma };
        return;
      }

      // Tilt away
      if (!tapTimeout && 
          Math.abs(beta - baseTilt.beta) > TILT_THRESHOLD && 
          Math.abs(gamma - baseTilt.gamma) > TILT_THRESHOLD) {
        tapTimeout = setTimeout(() => { tapTimeout = null; }, 700); // 0.7s window
      }

      // Return back to base tilt
      if (tapTimeout && 
          Math.abs(beta - baseTilt.beta) < RETURN_THRESHOLD && 
          Math.abs(gamma - baseTilt.gamma) < RETURN_THRESHOLD) {
        statusEl.textContent = "TAP âœ…";
        statusEl.style.color = "green";
        clearTimeout(tapTimeout);
        tapTimeout = null;

        // reset after 1s
        setTimeout(() => {
          statusEl.textContent = "Waiting...";
          statusEl.style.color = "black";
        }, 1000);
      }
    }
  </script>
</body>
</html>
